<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ boda.novios }} - Nuestra Boda</title>
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Montserrat:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body class="locked">
    <!-- Sobre / Envelope Overlay -->
    <div id="envelope-overlay">
        <div class="envelope-wrapper">
            <div class="envelope" id="envelope">
                <div class="paper">
                    <div class="paper-content">
                        <p class="paper-text">Invitación para</p>
                        <h2 class="paper-name">{{ invitado }}</h2>
                        <p class="paper-text">{{ pases }}</p>
                    </div>
                </div>
                <div class="pocket"></div>
                <div class="flap"></div>
                <div class="seal" onclick="abrirSobre()">
                    <span>L&C</span>
                </div>
            </div>
            <div id="action-area" class="hidden">
                <button class="btn-enter" onclick="entrar()">Ver Invitación</button>
            </div>
        </div>
    </div>

    <!-- Contenido Principal (Oculto inicialmente) -->
    <div id="main-content" class="hidden-content">
    <!-- Hero Section -->
    <header class="hero" style="background-image: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)), url('{{ boda.fotos.portada }}');">
        <div class="hero-content">
            <p class="intro">¡Nos Casamos!</p>
            <h1 class="nombres">{{ boda.novios }}</h1>
            <div class="fecha-badge">
                <span class="dia">{{ boda.fecha_dia }}</span>
                <span class="mes">{{ boda.fecha_mes }}</span>
                <span class="anio">{{ boda.fecha_anio }}</span>
            </div>
            <p class="lugar">{{ boda.lugar }}</p>
        </div>
    </header>

    <!-- Invitado Section -->
    <section class="invitacion container">
        <p class="frase">"{{ boda.frase }}"</p>
    </section>

    <!-- Cuenta Regresiva -->
    <section class="countdown-section">
        <h2>Faltan</h2>
        <div id="countdown" data-date="{{ boda.fecha_iso }}"></div>
    </section>

    <!-- Itinerario -->
    <section class="itinerario container">
        <h2>Itinerario</h2>
        <div class="timeline">
            {% for evento in boda.itinerario %}
            <div class="evento">
                <div class="icono"><i class="{{ evento.icono }}"></i></div>
                <div class="detalle">
                    <h3>{{ evento.hora }}</h3>
                    <p>{{ evento.actividad }}</p>
                </div>
            </div>
            {% endfor %}
        </div>
    </section>

    <!-- Ubicación -->
    <section class="ubicacion">
        <h2>Ubicación</h2>
        <div class="ubicacion-container">
            <div class="ubicacion-item">
                <h3><i class="fas fa-church" style="color: #d4af37;"></i> Ceremonia</h3>
                <p>{{ boda.ceremonia_lugar }}</p>
                <p>{{ boda.ceremonia_direccion }}</p>
                <a href="{{ boda.ceremonia_url }}" target="_blank" class="btn">Ver en Mapa</a>
            </div>
            <div class="ubicacion-item">
                <h3><i class="fas fa-glass-cheers" style="color: #d4af37;"></i> Recepción</h3>
                <p>{{ boda.lugar }}</p>
                <p>{{ boda.direccion }}</p>
                <a href="{{ boda.ubicacion_url }}" target="_blank" class="btn">Ver en Mapa</a>
            </div>
        </div>
    </section>

    <!-- Regalos y Dress Code -->
    <section class="detalles container">
        <div class="card">
            <i class="fas fa-gift"></i>
            <h3>Regalos</h3>
            <p>{{ boda.regalos.tipo }}</p>
            <p class="small">{{ boda.regalos.frase }}</p>
        </div>
        <div class="card">
            <i class="fas fa-tshirt"></i>
            <h3>Dress code</h3>
            <p>{{ boda.dress_code }}</p>
        </div>
    </section>

    <!-- Galería -->
    <section class="galeria">
        {% for foto in boda.fotos.galeria %}
        <img src="{{ foto }}" alt="Foto Boda">
        {% endfor %}
    </section>

    <footer>
        <p>Te esperamos para celebrar juntos.</p>
        <p>{{ boda.novios }}</p>
    </footer>
    </div>

    {% if boda.musica %}
    <!-- Audio de fondo -->
    <audio id="musica-boda">
        <source src="{{ url_for('static', filename=boda.musica) }}" type="audio/mpeg">
    </audio>
    {% endif %}
    
    <script>
        // Script simple para cuenta regresiva
        const fechaBoda = new Date("{{ boda.fecha_iso }}");
        const x = setInterval(function() {
            const now = new Date();
            const distance = fechaBoda - now;
            
            if (distance < 0) {
                document.getElementById("countdown").innerHTML = "¡Es hoy!";
                clearInterval(x);
                return;
            }

            // Cálculo de meses, días, horas, minutos
            let months = (fechaBoda.getFullYear() - now.getFullYear()) * 12 + (fechaBoda.getMonth() - now.getMonth());
            
            let tempDate = new Date(now);
            tempDate.setMonth(now.getMonth() + months);
            
            if (tempDate > fechaBoda) {
                months--;
                tempDate = new Date(now);
                tempDate.setMonth(now.getMonth() + months);
            }
            
            const remaining = fechaBoda - tempDate;
            const days = Math.floor(remaining / (1000 * 60 * 60 * 24));
            const hours = Math.floor((remaining % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((remaining % (1000 * 60 * 60)) / (1000 * 60));
            
            document.getElementById("countdown").innerHTML = 
                `<div class="time-box"><span>${months}</span> Meses</div>
                 <div class="time-box"><span>${days}</span> Días</div>
                 <div class="time-box"><span>${hours}</span> Hs</div>
                 <div class="time-box"><span>${minutes}</span> Min</div>`;
        }, 1000);

        // Script para abrir el sobre
        function abrirSobre() {
            const envelope = document.getElementById('envelope');
            const actionArea = document.getElementById('action-area');
            const audio = document.getElementById('musica-boda');
            
            envelope.classList.add('open');
            
            // Lógica de reproducción de música
            if (audio) {
                audio.currentTime = 20; // Empezar en el segundo 20
                audio.volume = 1.0;
                audio.play().catch(e => console.log("Reproducción automática bloqueada por el navegador", e));

                // Detener después de 1 minuto (60000 ms) con efecto fade-out
                setTimeout(() => {
                    const fadeAudio = setInterval(() => {
                        if (audio.volume > 0.05) {
                            audio.volume -= 0.05;
                        } else {
                            audio.pause();
                            clearInterval(fadeAudio);
                        }
                    }, 200); // Baja el volumen cada 200ms
                }, 60000);
            }

            // Mostrar botón después de la animación del sobre
            setTimeout(() => {
                actionArea.classList.remove('hidden');
                actionArea.classList.add('fade-in');
            }, 800);
        }

        function entrar() {
            const overlay = document.getElementById('envelope-overlay');
            const mainContent = document.getElementById('main-content');
            const body = document.body;

            overlay.classList.add('slide-up-out');
            
            setTimeout(() => {
                overlay.style.display = 'none';
                mainContent.classList.remove('hidden-content');
                mainContent.classList.add('fade-in-page');
                body.classList.remove('locked');
            }, 1000);
        }
    </script>
</body>
</html>