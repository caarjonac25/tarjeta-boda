<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ boda.novios }} - Nuestra Boda</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Raleway:wght@300;400;700&display=swap" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="locked">

    <!-- Overlay del Sobre -->
    <div id="envelope-overlay">
        <div class="envelope-wrapper">
            <div class="envelope" id="envelope">
                <div class="flap"></div>
                <div class="pocket"></div>
                <div class="paper">
                    <div class="paper-content">
                        <div class="paper-name">{{ invitado }}</div>
                        <p class="paper-text">Tenemos una invitación especial para ti</p>
                        <p class="paper-text" style="margin-top: 10px; font-size: 0.8rem;">{{ pases }}</p>
                    </div>
                </div>
                <div class="seal" id="seal">
                    <span>{{ boda.novios[0] }}&{{ boda.novios.split('&')[1].strip()[0] }}</span>
                </div>
            </div>
        </div>
        
        <div id="action-area" class="hidden">
            <button class="btn-enter" id="enter-btn">Ver invitación</button>
        </div>
    </div>

    <!-- Contenido Principal (Oculto inicialmente) -->
    <div id="main-content" class="hidden-content">
        <!-- Hero -->
        <header class="hero" style="background-image: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)), url('{{ boda.fotos.portada }}');">
            <div class="container">
                <p>¡Nos Casamos!</p>
                <h1 class="nombres">{{ boda.novios }}</h1>
                <div class="fecha-badge">
                    <span class="dia">{{ boda.fecha_dia }}</span>
                    <span class="mes">{{ boda.fecha_mes }}</span>
                    <span class="anio">{{ boda.fecha_anio }}</span>
                </div>
                <p>{{ boda.lugar }}</p>
            </div>
        </header>

        <!-- Frases Slider -->
        <section class="invitacion">
            <div class="slider-container">
                <div class="slider-track">
                    {% for frase in boda.frases %}
                    <div class="slide">
                        <p class="frase">"{{ frase }}"</p>
                    </div>
                    {% endfor %}
                    <!-- Clon para efecto infinito -->
                     <div class="slide">
                        <p class="frase">"{{ boda.frases[0] }}"</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Cuenta Regresiva -->
        <section class="countdown-section">
            <h2>Faltan</h2>
            <div id="countdown" data-date="{{ boda.fecha_iso }}">
                <div class="time-box"><span id="days">00</span>Días</div>
                <div class="time-box"><span id="hours">00</span>Hs</div>
                <div class="time-box"><span id="minutes">00</span>Min</div>
                <div class="time-box"><span id="seconds">00</span>Seg</div>
            </div>
        </section>

        <!-- Itinerario -->
        <section class="itinerario">
            <h2>Itinerario</h2>
            <div class="timeline">
                {% for item in boda.itinerario %}
                <div class="evento">
                    <div class="icono"><i class="{{ item.icono }}"></i></div>
                    <div class="info">
                        <h3>{{ item.hora }}</h3>
                        <p>{{ item.actividad }}</p>
                    </div>
                </div>
                {% endfor %}
            </div>
        </section>

        <!-- Ubicación -->
        <section class="ubicacion">
            <h2>Ubicación</h2>
            <div class="ubicacion-container">
                <div class="ubicacion-item">
                    <h3>Ceremonia</h3>
                    <p>{{ boda.ceremonia_lugar }}</p>
                    <p class="small">{{ boda.ceremonia_direccion }}</p>
                    <a href="{{ boda.ceremonia_url }}" target="_blank" class="btn">Ver Mapa</a>
                </div>
                <div class="ubicacion-item">
                    <h3>Recepción</h3>
                    <p>{{ boda.lugar }}</p>
                    <p class="small">{{ boda.direccion }}</p>
                    <a href="{{ boda.ubicacion_url }}" target="_blank" class="btn">Ver Mapa</a>
                </div>
            </div>
        </section>

        <!-- Regalos y Dress Code -->
        <section class="detalles">
            <div class="card">
                <i class="fas fa-gift"></i>
                <h3>Regalos</h3>
                <p>{{ boda.regalos.frase }}</p>
                <p><strong>{{ boda.regalos.tipo }}</strong></p>
            </div>
            <div class="card">
                <i class="fas fa-user-tie"></i>
                <h3>Código de Vestimenta</h3>
                <p>{{ boda.dress_code }}</p>
            </div>
        </section>

        <!-- Galería -->
        <section class="galeria">
            {% for foto in boda.fotos.galeria %}
            <img src="{{ foto }}" alt="Foto novios">
            {% endfor %}
        </section>

        <footer>
            <p>{{ boda.novios }} - {{ boda.fecha_anio }}</p>
        </footer>
    </div>

    <!-- Controles de Música -->
    <div class="music-controls hidden" id="music-controls">
        <button id="play-pause"><i class="fas fa-play"></i></button>
        <input type="range" id="volume" min="0" max="1" step="0.1" value="0.5">
    </div>

    <audio id="bg-music" loop>
        <source src="{{ url_for('static', filename=boda.musica) }}" type="audio/mp3">
    </audio>

    <script>
        // Lógica del Sobre y Animaciones
        const envelope = document.getElementById('envelope');
        const seal = document.getElementById('seal');
        const actionArea = document.getElementById('action-area');
        const overlay = document.getElementById('envelope-overlay');
        const mainContent = document.getElementById('main-content');
        const musicControls = document.getElementById('music-controls');
        const audio = document.getElementById('bg-music');
        const playBtn = document.getElementById('play-pause');
        let isMusicPlaying = false;

        seal.addEventListener('click', () => {
            envelope.classList.add('open');
            setTimeout(() => {
                actionArea.classList.remove('hidden');
                actionArea.classList.add('fade-in');
            }, 1000);
        });

        document.getElementById('enter-btn').addEventListener('click', () => {
            overlay.style.opacity = '0';
            setTimeout(() => {
                overlay.style.display = 'none';
                document.body.classList.remove('locked');
                mainContent.classList.remove('hidden-content');
                mainContent.classList.add('fade-in-page');
                musicControls.classList.remove('hidden');
                
                // Intentar reproducir música (los navegadores a veces bloquean esto sin interacción previa)
                audio.currentTime = 20;
                audio.play().then(() => {
                    isMusicPlaying = true;
                    playBtn.innerHTML = '<i class="fas fa-pause"></i>';
                }).catch(e => console.log("Autoplay bloqueado, usuario debe dar play manual"));
            }, 1000);
        });

        // Control de Música
        playBtn.addEventListener('click', () => {
            if (audio.paused) {
                audio.play();
                isMusicPlaying = true;
                playBtn.innerHTML = '<i class="fas fa-pause"></i>';
            } else {
                audio.pause();
                isMusicPlaying = false;
                playBtn.innerHTML = '<i class="fas fa-play"></i>';
            }
        });

        // Pausar música cuando la página no es visible
        document.addEventListener("visibilitychange", () => {
            if (document.hidden) {
                audio.pause();
            } else if (isMusicPlaying) {
                audio.play();
            }
        });

        document.getElementById('volume').addEventListener('input', (e) => {
            audio.volume = e.target.value;
        });

        // Cuenta Regresiva
        const targetDate = new Date(document.getElementById('countdown').dataset.date).getTime();
        
        setInterval(() => {
            const now = new Date().getTime();
            const distance = targetDate - now;

            if (distance < 0) {
                document.getElementById('countdown').innerHTML = "¡Es hoy!";
                return;
            }

            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distance % (1000 * 60)) / 1000);

            document.getElementById('days').innerText = days;
            document.getElementById('hours').innerText = hours;
            document.getElementById('minutes').innerText = minutes;
            document.getElementById('seconds').innerText = seconds;
        }, 1000);
    </script>
</body>
</html>